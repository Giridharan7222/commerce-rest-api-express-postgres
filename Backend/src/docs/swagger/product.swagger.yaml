paths:
  /api/products:
    post:
      summary: Create a new product (Admin only)
      tags: [Products]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - price
                - categoryId
              properties:
                name:
                  type: string
                  example: "iPhone 15 Pro"
                description:
                  type: string
                  example: "Latest Apple smartphone"
                price:
                  type: number
                  example: 999.99
                stock:
                  type: integer
                  example: 50
                categoryId:
                  type: string
                  format: uuid
                imageUrl:
                  type: string
                  format: uri
                cloudinaryPublicId:
                  type: string
                isActive:
                  type: boolean
                  default: true
      responses:
        "201":
          description: Product created successfully
        "400":
          description: Validation error
        "403":
          description: Access denied

    get:
      summary: Get products with optional filtering and pagination
      tags: [Products]
      description: |
        Retrieve products with optional filtering and pagination.
        
        **Without query parameters**: Returns all products (original behavior)
        
        **With query parameters**: Returns filtered and paginated results with pagination metadata
      parameters:
        - in: query
          name: search
          schema:
            type: string
          description: Search products by name (case-insensitive)
          example: "laptop"
        - in: query
          name: categoryId
          schema:
            type: string
            format: uuid
          description: Filter products by category ID
        - in: query
          name: minPrice
          schema:
            type: number
            minimum: 0
          description: Minimum price filter
          example: 100
        - in: query
          name: maxPrice
          schema:
            type: number
            minimum: 0
          description: Maximum price filter
          example: 1000
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number for pagination
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
          description: Number of items per page
      responses:
        "200":
          description: Products retrieved successfully
          content:
            application/json:
              schema:
                oneOf:
                  - type: object
                    properties:
                      success:
                        type: boolean
                      data:
                        type: array
                        items:
                          $ref: "#/components/schemas/Product"
                    description: All products (when no query parameters)
                  - type: object
                    properties:
                      success:
                        type: boolean
                      data:
                        $ref: "#/components/schemas/ProductListResponse"
                    description: Filtered products with pagination (when query parameters present)
              examples:
                allProducts:
                  summary: All products (no filters)
                  value:
                    success: true
                    data:
                      - id: "prod_123"
                        name: "Sample Product"
                        price: 299.99
                        category:
                          id: "cat_123"
                          name: "Electronics"
                filteredProducts:
                  summary: Filtered products with pagination
                  value:
                    success: true
                    data:
                      products:
                        - id: "prod_123"
                          name: "Gaming Laptop"
                          price: 899.99
                          category:
                            id: "cat_123"
                            name: "Electronics"
                      pagination:
                        currentPage: 1
                        totalPages: 5
                        totalItems: 50
                        itemsPerPage: 10

  /api/products/upload:
    post:
      summary: Create product with file uploads (Admin only)
      tags: [Products]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - name
                - price
                - categoryId
              properties:
                name:
                  type: string
                  example: "iPhone 15 Pro"
                description:
                  type: string
                  example: "Latest Apple smartphone"
                price:
                  type: number
                  example: 999.99
                stock:
                  type: integer
                  example: 50
                categoryId:
                  type: string
                  format: uuid
                isActive:
                  type: boolean
                  default: true
                mainImage:
                  type: string
                  format: binary
                  description: "Main product image (max 1 file)"
                additionalImages:
                  type: array
                  items:
                    type: string
                    format: binary
                  description: "Additional product images (max 10 files)"
      responses:
        "201":
          description: Product created successfully with uploaded images
        "400":
          description: Validation error or upload failed
        "403":
          description: Access denied

  /api/products/{id}:
    get:
      summary: Get product by ID
      tags: [Products]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Product details
        "404":
          description: Product not found

    put:
      summary: Update product (Admin only)
      tags: [Products]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
                price:
                  type: number
                stock:
                  type: integer
                categoryId:
                  type: string
                  format: uuid
                imageUrl:
                  type: string
                  format: uri
                cloudinaryPublicId:
                  type: string
                isActive:
                  type: boolean
      responses:
        "200":
          description: Product updated successfully
        "404":
          description: Product not found
        "403":
          description: Access denied

    delete:
      summary: Delete product (Admin only)
      tags: [Products]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Product deleted successfully
        "404":
          description: Product not found
        "403":
          description: Access denied

  /api/product-images:
    post:
      summary: Create product image (Admin only)
      tags: [Product Images]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - productId
                - imageUrl
              properties:
                productId:
                  type: string
                  format: uuid
                imageUrl:
                  type: string
                  format: uri
                publicId:
                  type: string
      responses:
        "201":
          description: Product image created successfully
        "400":
          description: Validation error
        "403":
          description: Access denied

  /api/products/{productId}/images:
    get:
      summary: Get product images
      tags: [Product Images]
      parameters:
        - in: path
          name: productId
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: List of product images
        "404":
          description: Product not found

  /api/product-images/{id}:
    put:
      summary: Update product image (Admin only)
      tags: [Product Images]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                imageUrl:
                  type: string
                  format: uri
                publicId:
                  type: string
      responses:
        "200":
          description: Product image updated successfully
        "404":
          description: Product image not found
        "403":
          description: Access denied

    delete:
      summary: Delete product image (Admin only)
      tags: [Product Images]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Product image deleted successfully
        "404":
          description: Product image not found
        "403":
          description: Access denied

components:
  schemas:
    Product:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        price:
          type: number
        stock:
          type: integer
        categoryId:
          type: string
          format: uuid
        imageUrl:
          type: string
          format: uri
        cloudinaryPublicId:
          type: string
        isActive:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        category:
          $ref: "#/components/schemas/Category"
        productImages:
          type: array
          items:
            $ref: "#/components/schemas/ProductImage"

    ProductImage:
      type: object
      properties:
        id:
          type: string
          format: uuid
        productId:
          type: string
          format: uuid
        imageUrl:
          type: string
          format: uri
        publicId:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ProductListResponse:
      type: object
      properties:
        products:
          type: array
          items:
            $ref: "#/components/schemas/Product"
        pagination:
          type: object
          properties:
            currentPage:
              type: integer
            totalPages:
              type: integer
            totalItems:
              type: integer
            itemsPerPage:
              type: integer
